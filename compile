#!/bin/bash

# CONFIG

if [ -z "$1" ]; then
	export AVALAM_COMPILE_ENV="dev"
else
	export AVALAM_COMPILE_ENV=$1
fi

rm ./.DS_Store 2> /dev/null
rm */.DS_Store 2> /dev/null
rm */*/.DS_Store 2> /dev/null
rm */*/*/.DS_Store 2> /dev/null

version=$(cat config/compile_version_base)
suffix=$(cat config/compile_version_suffix)
suffix=$(($suffix+1))

echo "Compilation de 'build/$AVALAM_COMPILE_ENV-$version.$suffix.exe'..."
echo "[$(date)] ++ Compilation de 'build/$AVALAM_COMPILE_ENV-$version.$suffix.exe' ..." >> logs/compile

echo "build/$AVALAM_COMPILE_ENV-$version.$suffix.exe" > config/last_version

g++ src/main.cpp src/classes/*/*.cpp -o build/$AVALAM_COMPILE_ENV-$version.$suffix.exe 

if [ $? -eq 0 ]; then
	echo $suffix > config/compile_version_suffix
	echo "Compilation rÃ©ussie"
fi

git add logs/compile > /dev/null 2> /dev/null
git commit -m "[AUTO]Compilation de 'build/dev-$version.$suffix.exe' ..." > /dev/null 2> /dev/null
git push > /dev/null 2> /dev/null
